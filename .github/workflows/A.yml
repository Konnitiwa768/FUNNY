name: Fix Texture Pack Structure

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  fix-pack:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Move to correct structure
        run: |
          mkdir -p PACK/assets/minecraft
          # 既存の間違った階層を移動
          if [ -d "PACK/minecraft/assets" ]; then
            mv PACK/minecraft/assets/* PACK/assets/minecraft/
            rm -rf PACK/minecraft
          fi
          # pack.mcmeta はそのまま残しておく
          if [ -f "PACK/pack.mcmeta" ]; then
            echo "pack.mcmeta exists"
          fi

      - name: ZIP the fixed pack
        run: |
          cd PACK
          zip -r ../MemePack-fixed.zip .
          cd ..

      - name: Create GitHub Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v1.0.0
          name: MemePack Fixed v1.0.0
          body: Corrected texture pack structure.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload ZIP to Release
        uses: softprops/action-gh-release@v1
        with:
          files: MemePack-fixed.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
